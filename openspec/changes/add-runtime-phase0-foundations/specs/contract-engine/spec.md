## ADDED Requirements

### Requirement: JSON Schema Enforcement
The contract engine SHALL load versioned JSON Schemas for each event type and artifact structure. Validation MUST be blocking: on failure, the engine SHALL raise `ContractViolation` and prevent event emission or artifact persistence.

#### Scenario: Event contract violation
- **WHEN** a worker emits a `work.*` event with payload missing required fields
- **THEN** `contract_engine.validate("work", event)` MUST raise `ContractViolation`, log an audit entry, and emit `evt.guardrail.contract-violation`

### Requirement: Violation Observability
Upon any `ContractViolation`, the runtime MUST emit an event `evt.guardrail.contract-violation`.
This event MUST include at minimum: `reason`, `schema_id`, `schema_version`, `actor_id`, and `run_id`.
This ensures visibility for alerting and dashboards beyond the static audit log.

### Requirement: Artifact Lifecycle Integration
The Artifact Lifecycle SHALL invoke the Contract Engine during the `publish()` transition.
If validation fails against the registered schema for that artifact type, the transition MUST be blocked.

#### Scenario: Publish validation failure
- **WHEN** `publish()` is called on an invalid artifact
- **THEN** the Contract Engine raises `ContractViolation` and the artifact remains in `draft` state

### Requirement: Version Pinning
Every schema SHALL be tagged with semver. The contract engine MUST allow multiple versions concurrently and route validation based on the event `version` or artifact `version` field.

#### Scenario: Dual versions registered
- **WHEN** versions `1.2.0` and `2.0.0` of a schema are registered
- **THEN** the engine MUST validate incoming payloads against their declared version and reject versions without a registered schema

### Requirement: Contract Registry
Contracts SHALL be stored in `contracts.yaml` artifacts generated by the factory. The engine MUST expose `register_contract(contract_descriptor)` and `list_contracts(filter)` to manage them.

#### Scenario: Registration audit
- **WHEN** a new contract is registered
- **THEN** the engine MUST emit `obs.contract.registered` with contract metadata and hash

### Requirement: Validation Context Hooks
The engine SHALL provide hooks to inject contextual data (tenant policies, feature flags) into schema validation via custom keywords. Hooks MUST be pure functions accepting `(payload, context)` and returning boolean.

#### Scenario: Contextual validation
- **WHEN** a schema declares `x-meshforge-tenant-tier`
- **THEN** the engine MUST pass the workspaceâ€™s tenant tier to the hook and only accept payloads authorized for that tier
